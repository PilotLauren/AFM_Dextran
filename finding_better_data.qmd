---
title: "Better Data"
author: "Lauren Puig"
format: pdf
editor: visual
---

```{r}
#| label: load-packages
#| message: false

library(tidyverse)
library(readr)
library(afmToolkit)
library(data.table)
#read_tsv() for tab separated
AFM_search <- read_tsv("~/AFM_Dextran/data afm 2.8.24/data_400[nm_ s]_5.txt", skip_empty_rows = TRUE, skip = 5, col_names = c("extension","force_f", "retraction", "force_r"))
AFM_a <- transform(AFM_search,force_r = rev(force_r), retraction = rev(retraction))
AFM_a
```

```{r}
#| label: graph-data

ggplot(AFM_a, aes(x = -retraction, y = -force_r))+
  geom_line()

```

```{r}
#| label: normalize-force

setpointAFM <- AFM_a |>
  slice(1:150)

zero_point <- mean(setpointAFM$force_f)
zero_point

AFM_normal <- AFM_a|>
  mutate(force_r = -force_r + zero_point)|>
  mutate(force_f = -force_f + zero_point)
AFM_normal
```

```{r}
#| label: find-start-extension

dextran_AFM_total <- AFM_normal|>
  filter(force_r > -500)#|>
  #filter(retraction <4775 & retraction > 4719.014)

max_force <- max(dextran_AFM_total$force_r)

dextran_AFM_entire <- AFM_normal|>
  filter(retraction < 4725 & retraction > max$retraction)
dextran_AFM_entire

max <- dextran_AFM_total |>
  filter(force_r == max_force)

dextran_first <- dextran_AFM_entire|>
  filter(retraction < max(retraction) & retraction > 4660)

dextran_not <- dextran_AFM_entire|>
  filter(retraction < 4680 & retraction >4655)

dextran_second <- dextran_AFM_entire |>
  filter(!retraction %in% dextran_not$retraction)




colss <- c("blue", "red")
exten <- c("extension", "retraction")

ggplot(dextran_second)+
  scale_x_reverse()+
  geom_line(aes(x = retraction, y = force_r, color = "red"))+
  geom_line(aes(x = extension, y = force_f, color = "blue"))+
  theme_bw()+
  scale_color_manual(name = "", labels = exten, values = colss)+
  labs(
    title = "Dextran force curve",
    x = "distance (nm)",
    y = "force (pN)",
    )#+
  #geom_smooth(aes(x = retraction_nm, y = force_r), se = FALSE, method = "gam", color = "black")

```

```{r}
#| label: start-from-zero


new_dextran_entire <- dextran_AFM_entire |>
  mutate(retraction = -(retraction - max(extension)))|>
  mutate(extension = -(extension - max(extension)))

new_dextran_second <- dextran_second|>
  mutate(retraction = -(retraction - max(extension)))|>
  mutate(extension = -(extension - max(extension)))

new_dextran_first <- dextran_first |>
  mutate(retraction = -(retraction - max(extension)))|>
  mutate(extension = -(extension - max(extension)))


ggplot(new_dextran_second)+
  #scale_x_reverse()+
  geom_line(aes(x = retraction, y = force_r, color = "red"))+
  geom_line(aes(x = extension, y = force_f, color = "blue"))+
  theme_bw()+
  scale_color_manual(name = "", labels = exten, values = colss)+
  labs(
    title = "Dextran force curve",
    x = "distance (nm)",
    y = "force (pN)",
    )#+
  #geom_smooth(aes(x = retraction_nm, y = force_r), se = FALSE, method = "gam", color = "black")
```

```{r}
#| label: save-files

write.csv(new_dextran_first, "/home/guest/AFM_Dextran/data1/new_dextran_first.csv", row.names=FALSE)
write.csv(new_dextran_second, "/home/guest/AFM_Dextran/data1/new_dextran_second.csv", row.names=FALSE)

write.csv(new_dextran_entire, "/home/guest/AFM_Dextran/data1/new_dextran_entire.csv", row.names=FALSE)

```
